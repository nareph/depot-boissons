// src/ui/change_password.slint

import { VerticalBox, HorizontalBox, LineEdit, Button, ProgressIndicator } from "std-widgets.slint";

export component ChangePasswordWindow inherits Window {
    title: "Changement de Mot de Passe - DÃ©pÃ´t de Boissons";
    width: 440px;
    height: 600px;

    in-out property<string> new_password_text: "";
    in-out property<string> confirm_password_text: "";
    in-out property<string> status_text: "";
    in-out property<bool> loading: false;
    in-out property<bool> is_error: false;

    callback confirm_clicked(string);
    callback request_close();

    Rectangle {
        width: 100%;
        height: 100%;
        background: @linear-gradient(145deg, #667eea 0%, #764ba2 100%);
        
        Rectangle {
            width: 400px;
            height: 520px;
            x: (parent.width - self.width) / 2;
            y: (parent.height - self.height) / 2;
            background: rgba(255, 255, 255, 0.25);
            border-radius: 20px;
            border-width: 1px;
            border-color: rgba(255, 255, 255, 0.3);
            drop-shadow-blur: 20px;
            drop-shadow-color: rgba(0, 0, 0, 0.1);

            VerticalBox {
                padding: 30px;
                spacing: 20px;
                alignment: center;

                Rectangle {
                    width: 80px;
                    height: 80px;
                    border-radius: 40px;
                    background: @linear-gradient(45deg, #ff6b6b 0%, #ee5a24 100%);
                    drop-shadow-blur: 10px;
                    drop-shadow-color: rgba(238, 90, 36, 0.3);

                    Text {
                        text: "ðŸ”’";
                        font-size: 32px;
                        vertical-alignment: center;
                        horizontal-alignment: center;
                    }
                }

                VerticalBox {
                    spacing: 5px;
                    alignment: center;
                    
                    Text {
                        text: "Changement de mot de passe";
                        horizontal-alignment: center;
                        font-size: 20px;
                        font-weight: 600;
                        color: white;
                        width: 100%;
                    }

                    Text {
                        text: "DÃ©finissez un nouveau mot de passe";
                        horizontal-alignment: center;
                        font-size: 13px;
                        color: rgba(255, 255, 255, 0.8);
                        width: 100%;
                    }
                }

                VerticalBox {
                    width: 100%;
                    spacing: 15px;
                    
                    Rectangle {
                        height: 55px;
                        width: 100%;
                        background: #2c3e50;
                        border-radius: 12px;
                        drop-shadow-blur: 5px;
                        drop-shadow-color: rgba(0, 0, 0, 0.1);

                        HorizontalBox {
                            padding-left: 15px;
                            padding-right: 15px;
                            spacing: 10px;
                            width: 100%;
                            height: 100%;
                            
                            Text {
                                text: "ðŸ†•";
                                font-size: 16px;
                                vertical-alignment: center;
                                horizontal-alignment: center;
                                color: #bdc3c7;
                                width: 25px;
                            }
                            
                            LineEdit {
                                placeholder-text: "Nouveau mot de passe";
                                input-type: InputType.password;
                                text <=> root.new_password_text;
                                enabled: !root.loading;
                                font-size: 14px;
                                horizontal-stretch: 1;
                               // vertical-alignment: center;
                            }
                        }
                    }
                    
                    Rectangle {
                        height: 55px;
                        width: 100%;
                        background: #2c3e50;
                        border-radius: 12px;
                        drop-shadow-blur: 5px;
                        drop-shadow-color: rgba(0, 0, 0, 0.1);

                        HorizontalBox {
                            padding-left: 15px;
                            padding-right: 15px;
                            spacing: 10px;
                            width: 100%;
                            height: 100%;
                            
                            Text {
                                text: "âœ…";
                                font-size: 16px;
                                vertical-alignment: center;
                                horizontal-alignment: center;
                                color: #bdc3c7;
                                width: 25px;
                            }
                            
                            LineEdit {
                                placeholder-text: "Confirmer le mot de passe";
                                input-type: InputType.password;
                                text <=> root.confirm_password_text;
                                enabled: !root.loading;
                                font-size: 14px;
                                horizontal-stretch: 1;
                                //vertical-alignment: center;
                            }
                        }
                    }
                }

                Rectangle {
                    height: 55px;
                    width: 100%;
                    background: root.loading || root.new_password_text == "" || root.new_password_text != root.confirm_password_text ? 
                               rgba(102, 126, 234, 0.5) : 
                               @linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    border-radius: 12px;
                    drop-shadow-blur: 10px;
                    drop-shadow-color: rgba(102, 126, 234, 0.3);

                    if !root.loading: Button {
                        width: 100%;
                        height: 100%;
                        text: "Confirmer";
                        enabled: !root.loading && root.new_password_text != "" && root.new_password_text == root.confirm_password_text;
                        clicked => { root.confirm_clicked(root.new_password_text) }
                    }

                    if root.loading: HorizontalBox {
                        alignment: center;
                        ProgressIndicator {
                            width: 24px;
                            height: 24px;
                            indeterminate: true;
                        }
                        Text {
                            text: "Enregistrement...";
                            color: white;
                            font-size: 14px;
                            vertical-alignment: center;
                        }
                    }
                }

                if root.status_text != "": Rectangle {
                    height: 50px;
                    width: 100%;
                    background: root.is_error ? 
                               rgba(255, 107, 107, 0.2) : 
                               rgba(46, 213, 115, 0.2);
                    border-radius: 12px;
                    border-width: 1px;
                    border-color: root.is_error ? 
                                  rgba(255, 107, 107, 0.5) : 
                                  rgba(46, 213, 115, 0.5);

                    Text {
                        text: root.status_text;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                        font-size: 13px;
                        font-weight: 500;
                        color: root.is_error ? 
                               #ff6b6b : 
                               #2ed573;
                    }
                }
            }
        }

        Rectangle {
            width: 100px;
            height: 100px;
            x: 50px;
            y: 80px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50px;
        }

        Rectangle {
            width: 60px;
            height: 60px;
            x: 320px;
            y: 400px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 30px;
        }
    }
}