// src/ui/main.slint 

import { HorizontalBox, VerticalBox } from "std-widgets.slint";
import { AppHeader } from "./components/header.slint";
import { AppSidebar } from "./components/sidebar.slint";
import { DashboardView } from "./views/dashboard.slint";
import { ProductsView } from "./views/products.slint";
import { SalesView } from "./views/sales.slint";
import { UsersView } from "./views/users.slint";
import { LowStockProductUI, ProductUI, UserUI } from "./components/models.slint";

export component MainWindow inherits Window {
    title: "Tableau de Bord - Dépôt de Boissons";
    
    min-width: 800px;
    min-height: 600px;
    preferred-width: 1200px;
    preferred-height: 800px;
    
    // Propriétés communes
    in-out property <string> welcome_message;
    in property <bool> is_admin;
    in property <string> today_revenue;
    in property <string> today_sales_count;
    in property <[LowStockProductUI]> low_stock_products_model;
    in property <[ProductUI]> products_model;
    in property <int> current_page: 1;
    in property <int> total_pages: 1;
    in property <int> total_products: 0;
    in property <int> products_per_page: 10;
    in property <string> search_query: "";
    in property <string> stock_filter: "all"; // "all", "in_stock", "out_of_stock"
    in property <string> sort_by: "name"; // "name", "stock", "price"
    in property <string> sort_order: "asc"; 
    in property <[UserUI]> users_model;
    
    // Callbacks
    callback request_dashboard_data();
    callback request_products();
    callback request_users();
    
    // Callbacks pour les utilisateurs
    callback add_user_clicked();
    callback edit_user_clicked(string);         
    callback delete_user_clicked(string, string); 
    callback reset_password_clicked(string, string);    

    // Callbacks pour les produits
    callback add_product_clicked();
    callback edit_product_clicked(string);      
    callback delete_product_clicked(string, string);    
    callback search_products(string);
    callback filter_products(string);
    callback sort_products(string, string);
    callback change_page(int);
    callback change_page_size(int);

    // Callbacks de session
    callback change_password_clicked();
    callback logout_clicked();

    property <int> current_view_index: 0;
    
    Rectangle {
        width: 100%;
        height: 100%;
        background: @linear-gradient(145deg, #667eea 0%, #764ba2 100%);
        
        VerticalBox {
            spacing: 2px;
            padding: 0px;
            
            AppHeader {
                height: 60px;
                welcome_message: root.welcome_message;
                change_password_clicked => { root.change_password_clicked(); }
                logout_clicked => { root.logout_clicked(); }
            }

            HorizontalBox {
                spacing: 0px;
                padding: 0px;
                
                AppSidebar {
                    current_view_index: root.current_view_index;
                    is_admin: root.is_admin;
                    view-changed(index) => { root.current_view_index = index; }
                }
                // Zone de contenu principal qui s'étire automatiquement
                Rectangle {
                    background: transparent;
                    // Cette zone prend automatiquement tout l'espace restant
                    
                    if root.current_view_index == 0: DashboardView {
                        width: 100%;
                        height: 100%;
                        today_revenue: root.today_revenue;
                        today_sales_count: root.today_sales_count;
                        low_stock_products_model: root.low_stock_products_model;
                    }
                    if root.current_view_index == 1: ProductsView {
                        width: 100%;
                        height: 100%;
                        products_model: root.products_model;
                        is_admin: root.is_admin;  
                        current_page: root.current_page;
                        total_pages: root.total_pages;
                        total_products: root.total_products;
                        products_per_page: root.products_per_page;
                        search_query: root.search_query;
                        stock_filter: root.stock_filter;
                        sort_by: root.sort_by;
                        sort_order: root.sort_order;
                        request_products => { root.request_products(); }
                        add_product_clicked => { root.add_product_clicked() }
                        edit_product_clicked(product_id) => { root.edit_product_clicked(product_id) }
                        delete_product_clicked(product_id, product_name) => { root.delete_product_clicked(product_id, product_name) }
                        search_products(search_term) => { root.search_products(search_term); }
                        filter_products(filter_term) => { root.filter_products(filter_term); }
                        sort_products(sort_by, sort_order) => { root.sort_products(sort_by, sort_order); }
                        change_page(page) => { root.change_page(page); }
                        change_page_size(page_size) => { root.change_page_size(page_size); }
                    }

                    if root.current_view_index == 2: SalesView {
                        width: 100%;
                        height: 100%;
                    }
                    if root.current_view_index == 3: UsersView {
                        width: 100%;
                        height: 100%;
                        users_model: root.users_model;
                        add_user_clicked => { root.add_user_clicked(); }
                        edit_user_clicked(user_id) => { root.edit_user_clicked(user_id); }
                        delete_user_clicked(user_id, username) => { root.delete_user_clicked(user_id, username); }
                        reset_password_clicked(user_id, username) => { root.reset_password_clicked(user_id, username); }
                    }
                }
            }
        }
    }
}