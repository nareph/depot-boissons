import { VerticalBox, HorizontalBox, LineEdit, Button, ProgressIndicator } from "std-widgets.slint";

export component LoginWindow inherits Window {
    title: "Connexion - D√©p√¥t de Boissons";
    width: 420px;
    height: 560px;

    in-out property<string> login_text: "";
    in-out property<string> password_text: "";
    in-out property<string> status_text: "";
    in-out property<bool> loading: false;

    callback login_clicked(string, string);
    callback request_close();

    // Arri√®re-plan avec d√©grad√©
    Rectangle {
        width: 100%;
        height: 100%;
        background: @linear-gradient(145deg, #667eea 0%, #764ba2 100%);
        
        // Carte de connexion centrale
        Rectangle {
            width: 360px;
            height: 480px;
            x: (parent.width - self.width) / 2;
            y: (parent.height - self.height) / 2;
            background: rgba(255, 255, 255, 0.25);
            border-radius: 20px;
            border-width: 1px;
            border-color: rgba(255, 255, 255, 0.3);
            drop-shadow-blur: 20px;
            drop-shadow-color: rgba(0, 0, 0, 0.1);

            VerticalBox {
                padding: 40px;
                spacing: 25px;
                alignment: center;

                // Logo/Ic√¥ne avec alignement centr√©
                Rectangle {
                    width: 80px;
                    height: 80px;
                    border-radius: 40px;
                    background: @linear-gradient(45deg, #ff6b6b 0%, #ee5a24 100%);
                    drop-shadow-blur: 10px;
                    drop-shadow-color: rgba(238, 90, 36, 0.3);

                    Text {
                        text: "ü•§";
                        font-size: 40px; 
                        vertical-alignment: center;
                        horizontal-alignment: center;
                        width: 100%; 
                        height: 100%; 
                    }
                }

                // Titre
                Text {
                    text: "Bienvenue";
                    horizontal-alignment: center;
                    font-size: 28px;
                    font-weight: 600;
                    color: white;
                }

                Text {
                    text: "Connectez-vous √† votre compte";
                    horizontal-alignment: center;
                    font-size: 14px;
                    color: rgba(255, 255, 255, 0.8);
                }

                // Champs de saisie avec conteneurs styl√©s
                VerticalBox {
                    spacing: 15px;
                    
                    // Conteneur pour le champ email
                    Rectangle {
                        height: 55px;
                        background: #2c3e50;
                        border-radius: 12px;
                        drop-shadow-blur: 5px;
                        drop-shadow-color: rgba(0, 0, 0, 0.1);

                        HorizontalBox {
                            padding: 0px;
                            spacing: 0px;
                            
                            // Conteneur fixe pour l'ic√¥ne 
                            Rectangle {
                                width: 50px;
                                height: 55px;
                                
                                Text {
                                    text: "üë§";
                                    font-size: 18px;
                                    vertical-alignment: center;
                                    horizontal-alignment: center;
                                    color: #bdc3c7;
                                }
                            }
                            
                            // S√©parateur visuel
                            Rectangle {
                                width: 1px;
                                height: 35px;
                                background: rgba(189, 195, 199, 0.3);
                                y: 10px;
                            }
                            
                            LineEdit {
                                placeholder-text: "Nom d'utilisateur";
                                text <=> root.login_text;
                                enabled: !root.loading;
                                font-size: 14px;
                                horizontal-stretch: 1; // Prend tout l'espace disponible
                            }
                        }
                    }
                    
                    Rectangle {
                        height: 55px;
                        background: #2c3e50;
                        border-radius: 12px;
                        drop-shadow-blur: 5px;
                        drop-shadow-color: rgba(0, 0, 0, 0.1);

                        HorizontalBox {
                            padding: 0px;
                            spacing: 0px;
                            
                            // Conteneur fixe pour l'ic√¥ne
                            Rectangle {
                                width: 50px;
                                height: 55px;
                                
                                Text {
                                    text: "üîê";
                                    font-size: 16px;
                                    vertical-alignment: center;
                                    horizontal-alignment: center;
                                    color: #bdc3c7;
                                }
                            }
                            
                            // S√©parateur visuel
                            Rectangle {
                                width: 1px;
                                height: 35px;
                                background: rgba(189, 195, 199, 0.3);
                                y: 10px;
                            }
                            
                            LineEdit {
                                placeholder-text: "Mot de passe";
                                input-type: InputType.password;
                                text <=> root.password_text;
                                enabled: !root.loading;
                                font-size: 14px;
                                horizontal-stretch: 1; // Prend tout l'espace disponible
                            }
                        }
                    }
                }

                // Conteneur pour le bouton de connexion avec gestion du loading
                Rectangle {
                    height: 55px;
                    background: root.loading || root.login_text == "" || root.password_text == "" ? 
                               rgba(102, 126, 234, 0.5) : 
                               @linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    border-radius: 12px;
                    drop-shadow-blur: 10px;
                    drop-shadow-color: rgba(102, 126, 234, 0.3);

                    // Bouton normal
                    if !root.loading: Button {
                        width: 100%;
                        height: 100%;
                        text: "Se connecter";
                        enabled: !root.loading && root.login_text != "" && root.password_text != "";
                        clicked => { root.login_clicked(root.login_text, root.password_text) }
                    }

                    // Indicateur de chargement dans le m√™me rectangle
                    if root.loading: HorizontalBox {
                        width: 100%;
                        height: 100%;
                        alignment: center;
                        spacing: 10px;
                        
                        ProgressIndicator {
                            width: 24px;
                            height: 24px;
                            indeterminate: true;
                        }
                        Text {
                            text: "Connexion en cours...";
                            color: white;
                            font-size: 14px;
                            font-weight: 500;
                            vertical-alignment: center;
                        }
                    }
                }

                // Message de statut - affich√© seulement si pas en loading
                if root.status_text != "" && !root.loading: Rectangle {
                    height: 50px;
                    background: root.status_text == "Mot de passe incorrect" || 
                               root.status_text == "Utilisateur non trouv√©" || 
                               root.status_text == "Erreur de v√©rification" ? 
                               rgba(255, 107, 107, 0.2) : 
                               (root.status_text == "Connexion r√©ussie" ? 
                                rgba(46, 213, 115, 0.2) : 
                                rgba(255, 255, 255, 0.1));
                    border-radius: 8px;
                    border-width: 1px;
                    border-color: root.status_text == "Mot de passe incorrect" || 
                                  root.status_text == "Utilisateur non trouv√©" || 
                                  root.status_text == "Erreur de v√©rification" ? 
                                  rgba(255, 107, 107, 0.5) : 
                                  (root.status_text == "Connexion r√©ussie" ? 
                                   rgba(46, 213, 115, 0.5) : 
                                   rgba(255, 255, 255, 0.3));

                    Text {
                        text: root.status_text;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                        font-size: 13px;
                        font-weight: 500;
                        color: root.status_text == "Mot de passe incorrect" || 
                               root.status_text == "Utilisateur non trouv√©" || 
                               root.status_text == "Erreur de v√©rification" ? 
                               #ff6b6b : 
                               (root.status_text == "Connexion r√©ussie" ? 
                                #2ed573 : 
                                rgba(255, 255, 255, 0.9));
                    }
                }
            }
        }

        // √âl√©ments d√©coratifs en arri√®re-plan
        Rectangle {
            width: 100px;
            height: 100px;
            x: 50px;
            y: 80px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50px;
        }

        Rectangle {
            width: 60px;
            height: 60px;
            x: 320px;
            y: 400px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 30px;
        }

        Rectangle {
            width: 80px;
            height: 80px;
            x: 30px;
            y: 350px;
            background: rgba(255, 255, 255, 0.06);
            border-radius: 40px;
        }
    }
}