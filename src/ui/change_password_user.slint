import { VerticalBox, HorizontalBox, LineEdit, Button, ProgressIndicator } from "std-widgets.slint";

export component ChangePasswordUserWindow inherits Window {
    title: "Changer mon mot de passe - D√©p√¥t de Boissons";
    width: 440px;
    height: 580px;

    in-out property<string> old_password_text: "";
    in-out property<string> new_password_text: "";
    in-out property<string> confirm_password_text: "";
    in-out property<string> status_text: "";
    in-out property<bool> loading: false;
    in-out property<bool> is_error: false;

    callback save_clicked(string, string);
    callback request_close();

    // Arri√®re-plan avec d√©grad√© coh√©rent
    Rectangle {
        width: 100%;
        height: 100%;
        background: @linear-gradient(145deg, #667eea 0%, #764ba2 100%);
        
        // Carte centrale
        Rectangle {
            width: 400px;
            height: 500px;
            x: (parent.width - self.width) / 2;
            y: (parent.height - self.height) / 2;
            background: rgba(255, 255, 255, 0.25);
            border-radius: 20px;
            border-width: 1px;
            border-color: rgba(255, 255, 255, 0.3);
            drop-shadow-blur: 20px;
            drop-shadow-color: rgba(0, 0, 0, 0.1);

            VerticalBox {
                padding: 25px;
                spacing: 15px;
                alignment: center;

                // Ic√¥ne
                Rectangle {
                    width: 75px;
                    height: 75px;
                    border-radius: 37.5px;
                    background: @linear-gradient(45deg, #ff6b6b 0%, #ee5a24 100%);
                    drop-shadow-blur: 8px;
                    drop-shadow-color: rgba(238, 90, 36, 0.3);

                    Text {
                        text: "üîë";
                        font-size: 34px;
                        vertical-alignment: center;
                        horizontal-alignment: center;
                    }
                }

                // Titre
                VerticalBox {
                    spacing: 4px;
                    alignment: center;
                    
                    Text {
                        text: "Changer mon mot de passe";
                        horizontal-alignment: center;
                        font-size: 19px;
                        font-weight: 600;
                        color: white;
                    }

                    Text {
                        text: "Veuillez saisir vos mots de passe";
                        horizontal-alignment: center;
                        font-size: 12px;
                        color: rgba(255, 255, 255, 0.8);
                    }
                }

                // Champs de saisie
                VerticalBox {
                    width: 100%;
                    spacing: 12px;
                    
                    // Ancien mot de passe
                    Rectangle {
                        height: 48px;
                        width: 100%;
                        background: #2c3e50;
                        border-radius: 10px;
                        drop-shadow-blur: 4px;
                        drop-shadow-color: rgba(0, 0, 0, 0.1);

                        HorizontalBox {
                            padding-left: 12px;
                            padding-right: 12px;
                            spacing: 8px;
                            width: 100%;
                            height: 100%;
                            
                            Text {
                                text: "üîê";
                                font-size: 15px;
                                vertical-alignment: center;
                                horizontal-alignment: center;
                                color: #bdc3c7;
                                width: 20px;
                            }
                            
                            LineEdit {
                                placeholder-text: "Ancien mot de passe";
                                input-type: InputType.password;
                                text <=> root.old_password_text;
                                enabled: !root.loading;
                                font-size: 13px;
                                horizontal-stretch: 1;
                               // vertical-alignment: center;
                            }
                        }
                    }
                    
                    // Nouveau mot de passe
                    Rectangle {
                        height: 48px;
                        width: 100%;
                        background: #2c3e50;
                        border-radius: 10px;
                        drop-shadow-blur: 4px;
                        drop-shadow-color: rgba(0, 0, 0, 0.1);

                        HorizontalBox {
                            padding-left: 12px;
                            padding-right: 12px;
                            spacing: 8px;
                            width: 100%;
                            height: 100%;
                            
                            Text {
                                text: "üÜï";
                                font-size: 15px;
                                vertical-alignment: center;
                                horizontal-alignment: center;
                                color: #bdc3c7;
                                width: 20px;
                            }
                            
                            LineEdit {
                                placeholder-text: "Nouveau mot de passe";
                                input-type: InputType.password;
                                text <=> root.new_password_text;
                                enabled: !root.loading;
                                font-size: 13px;
                                horizontal-stretch: 1;
                                //vertical-alignment: center;
                            }
                        }
                    }
                    
                    // Confirmation
                    Rectangle {
                        height: 48px;
                        width: 100%;
                        background: #2c3e50;
                        border-radius: 10px;
                        drop-shadow-blur: 4px;
                        drop-shadow-color: rgba(0, 0, 0, 0.1);

                        HorizontalBox {
                            padding-left: 12px;
                            padding-right: 12px;
                            spacing: 8px;
                            width: 100%;
                            height: 100%;
                            
                            Text {
                                text: "‚úÖ";
                                font-size: 15px;
                                vertical-alignment: center;
                                horizontal-alignment: center;
                                color: #bdc3c7;
                                width: 20px;
                            }
                            
                            LineEdit {
                                placeholder-text: "Confirmer le mot de passe";
                                input-type: InputType.password;
                                text <=> root.confirm_password_text;
                                enabled: !root.loading;
                                font-size: 13px;
                                horizontal-stretch: 1;
                                //vertical-alignment: center;
                            }
                        }
                    }
                }

                // Bouton d'enregistrement
                Rectangle {
                    height: 48px;
                    width: 100%;
                    background: root.loading || root.old_password_text == "" || root.new_password_text == "" || root.new_password_text != root.confirm_password_text ? 
                               rgba(102, 126, 234, 0.5) : 
                               @linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    border-radius: 10px;
                    drop-shadow-blur: 8px;
                    drop-shadow-color: rgba(102, 126, 234, 0.3);

                    if !root.loading: Button {
                        width: 100%;
                        height: 100%;
                        text: "Enregistrer";
                        enabled: !root.loading && root.old_password_text != "" && root.new_password_text != "" && root.new_password_text == root.confirm_password_text;
                        clicked => { root.save_clicked(root.old_password_text, root.new_password_text) }
                    }

                    if root.loading: HorizontalBox {
                        alignment: center;
                        ProgressIndicator {
                            width: 22px;
                            height: 22px;
                            indeterminate: true;
                        }
                        Text {
                            text: "Enregistrement...";
                            color: white;
                            font-size: 13px;
                            vertical-alignment: center;
                        }
                    }
                }

                // Message de statut
                if root.status_text != "": Rectangle {
                    height: 45px;
                    width: 100%;
                    background: root.is_error ? 
                               rgba(255, 107, 107, 0.2) : 
                               rgba(46, 213, 115, 0.2);
                    border-radius: 8px;
                    border-width: 1px;
                    border-color: root.is_error ? 
                                  rgba(255, 107, 107, 0.5) : 
                                  rgba(46, 213, 115, 0.5);

                    Text {
                        text: root.status_text;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                        font-size: 12px;
                        font-weight: 500;
                        color: root.is_error ? 
                               #ff6b6b : 
                               #2ed573;
                    }
                }
            }
        }

        // √âl√©ments d√©coratifs
        Rectangle {
            width: 90px;
            height: 90px;
            x: 40px;
            y: 70px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 45px;
        }

        Rectangle {
            width: 50px;
            height: 50px;
            x: 330px;
            y: 420px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 25px;
        }
    }
}