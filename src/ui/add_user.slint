import { VerticalBox, HorizontalBox, LineEdit, Button, ComboBox, ProgressIndicator } from "std-widgets.slint";

export component AddUserWindow inherits Window {
    title: "Ajouter un utilisateur - D√©p√¥t de Boissons";
    width: 460px;
    height: 620px;

    in-out property<string> name_text: "";
    in-out property<string> email_text: "";
    in-out property<string> password_text: "";
    in-out property<string> status_text: "";
    in-out property<int> selected_role_index: 0;
    in property<[string]> roles: ["Utilisateur", "Administrateur"];
    in-out property<bool> loading: false;
    in-out property<bool> is_error: false;

    callback save_clicked(string, string, string, string);
    callback request_close();

    Rectangle {
        width: 100%;
        height: 100%;
        background: @linear-gradient(145deg, #667eea 0%, #764ba2 100%);
        
        Rectangle {
            width: 420px;
            height: 540px;
            x: (parent.width - self.width) / 2;
            y: (parent.height - self.height) / 2;
            background: rgba(255, 255, 255, 0.25);
            border-radius: 20px;
            border-width: 1px;
            border-color: rgba(255, 255, 255, 0.3);
            drop-shadow-blur: 20px;
            drop-shadow-color: rgba(0, 0, 0, 0.1);

            VerticalBox {
                padding: 25px;
                spacing: 15px;
                alignment: center;

                Rectangle {
                    width: 70px;
                    height: 70px;
                    border-radius: 35px;
                    background: @linear-gradient(45deg, #ff6b6b 0%, #ee5a24 100%);
                    drop-shadow-blur: 8px;
                    drop-shadow-color: rgba(238, 90, 36, 0.3);

                    Text {
                        text: "üë§";
                        font-size: 32px;
                        vertical-alignment: center;
                        horizontal-alignment: center;
                    }
                }

                Text {
                    text: "Ajouter un utilisateur";
                    horizontal-alignment: center;
                    font-size: 20px;
                    font-weight: 600;
                    color: white;
                }

                VerticalBox {
                    width: 100%;
                    spacing: 12px;
                    
                    Rectangle {
                        height: 50px;
                        background: #2c3e50;
                        border-radius: 10px;
                        drop-shadow-blur: 5px;

                        HorizontalBox {
                            padding-left: 12px;
                            padding-right: 12px;
                            alignment: center;
                            spacing: 8px;
                            
                            Text {
                                text: "üë§";
                                font-size: 14px;
                                vertical-alignment: center;
                                color: #bdc3c7;
                            }
                            
                            LineEdit {
                                placeholder-text: "Nom complet";
                                text <=> root.name_text;
                                enabled: !root.loading;
                                font-size: 13px;
                                width: 100%;
                            }
                        }
                    }
                    
                    Rectangle {
                        height: 50px;
                        background: #2c3e50;
                        border-radius: 10px;
                        drop-shadow-blur: 5px;

                        HorizontalBox {
                            padding-left: 12px;
                            padding-right: 12px;
                            alignment: center;
                            spacing: 8px;
                            
                            Text {
                                text: "‚úâÔ∏è";
                                font-size: 14px;
                                vertical-alignment: center;
                                color: #bdc3c7;
                            }
                            
                            LineEdit {
                                placeholder-text: "Adresse e-mail";
                                text <=> root.email_text;
                                enabled: !root.loading;
                                font-size: 13px;
                                width: 100%;
                            }
                        }
                    }
                    
                    Rectangle {
                        height: 50px;
                        background: #2c3e50;
                        border-radius: 10px;
                        drop-shadow-blur: 5px;

                        HorizontalBox {
                            padding-left: 12px;
                            padding-right: 12px;
                            alignment: center;
                            spacing: 8px;
                            
                            Text {
                                text: "üîë";
                                font-size: 14px;
                                vertical-alignment: center;
                                color: #bdc3c7;
                            }
                            
                            LineEdit {
                                placeholder-text: "Mot de passe temporaire";
                                input-type: InputType.password;
                                text <=> root.password_text;
                                enabled: !root.loading;
                                font-size: 13px;
                                width: 100%;
                            }
                        }
                    }
                    
                    Rectangle {
                        height: 50px;
                        background: #2c3e50;
                        border-radius: 10px;
                        drop-shadow-blur: 5px;

                        HorizontalBox {
                            padding-left: 12px;
                            padding-right: 12px;
                            alignment: center;
                            spacing: 8px;
                            
                            Text {
                                text: "üé≠";
                                font-size: 14px;
                                vertical-alignment: center;
                                color: #bdc3c7;
                            }
                            
                            ComboBox {
                                model: root.roles;
                                current-index <=> root.selected_role_index;
                                enabled: !root.loading;
                                width: 100%;
                            }
                        }
                    }
                }

                Rectangle {
                    height: 50px;
                    width: 100%;
                    background: root.loading || root.name_text == "" || root.email_text == "" || root.password_text == "" ? 
                               rgba(102, 126, 234, 0.5) : 
                               @linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    border-radius: 10px;
                    drop-shadow-blur: 8px;

                    if !root.loading: Button {
                        width: 100%;
                        height: 100%;
                        text: "Enregistrer";
                        enabled: !root.loading && root.name_text != "" && root.email_text != "" && root.password_text != "";
                        clicked => { root.save_clicked(root.name_text, root.email_text, root.password_text, root.roles[root.selected_role_index]) }
                    }

                    if root.loading: HorizontalBox {
                        alignment: center;
                        ProgressIndicator {
                            width: 20px;
                            height: 20px;
                            indeterminate: true;
                        }
                        Text {
                            text: "Enregistrement...";
                            color: white;
                            font-size: 13px;
                            vertical-alignment: center;
                        }
                    }
                }

                if root.status_text != "": Rectangle {
                    height: 45px;
                    width: 100%;
                    background: root.is_error ? 
                               rgba(255, 107, 107, 0.2) : 
                               rgba(46, 213, 115, 0.2);
                    border-radius: 8px;
                    border-width: 1px;

                    Text {
                        text: root.status_text;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                        font-size: 12px;
                        font-weight: 500;
                        color: root.is_error ? #ff6b6b : #2ed573;
                    }
                }
            }
        }

        Rectangle {
            width: 100px;
            height: 100px;
            x: 50px;
            y: 80px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50px;
        }

        Rectangle {
            width: 60px;
            height: 60px;
            x: 350px;
            y: 420px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 30px;
        }
    }
}